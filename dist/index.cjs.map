{"version":3,"sources":["../src/mod/logger.ts","../src/mod/resource_merger.ts","../src/mod/plugin_registry.ts"],"names":["Logger","debug","name","msg","err","ResourceMerger","logger","userRoutes","pluginRoutes","merged","userPaths","r","route","key","userSchemas","pluginSchemas","userTables","schema","userStatic","pluginStatic","PluginRegistry","plugin","app","hook","ctx","routes","schemas","middlewares","mw","statics"],"mappings":"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","file":"index.cjs","sourcesContent":["// src/mod/logger.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class Logger {\r\n        constructor(private debug: boolean = false) {}\r\n\r\n        phase(name: string) {\r\n            if (!this.debug) return;\r\n            console.log(`\\n[CruxJS] ⚡ Phase: ${name}`);\r\n        }\r\n\r\n        info(msg: string) {\r\n            if (!this.debug) return;\r\n            console.log(`[CruxJS] ${msg}`);\r\n        }\r\n\r\n        success(msg: string) {\r\n            if (!this.debug) return;\r\n            console.log(`[CruxJS] ✓ ${msg}`);\r\n        }\r\n\r\n        error(msg: string, err?: Error) {\r\n            console.error(`[CruxJS] ✗ ${msg}`);\r\n            if (err) console.error(err);\r\n        }\r\n\r\n        plugin(name: string, msg: string) {\r\n            if (!this.debug) return;\r\n            console.log(`[CruxJS:${name}] ${msg}`);\r\n        }\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝","// src/mod/resource_merger.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import { RouteDefinition, TableSchema, StaticConfig } from '../types';\r\n    import { Logger } from './logger';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class ResourceMerger {\r\n        private logger: Logger;\r\n\r\n        constructor(logger: Logger) {\r\n            this.logger = logger;\r\n        }\r\n\r\n        mergeRoutes(\r\n            userRoutes: RouteDefinition[] = [],\r\n            pluginRoutes: RouteDefinition[] = []\r\n        ): RouteDefinition[] {\r\n            // User routes have priority\r\n            const merged = [...userRoutes];\r\n            const userPaths = new Set(userRoutes.map(r => `${r.method}:${r.path}`));\r\n\r\n            for (const route of pluginRoutes) {\r\n                const key = `${route.method}:${route.path}`;\r\n\r\n                if (!userPaths.has(key)) {\r\n                    merged.push(route);\r\n                } else {\r\n                    this.logger.info(`Skipping plugin route ${key} (overridden by user)`);\r\n                }\r\n            }\r\n\r\n            return merged;\r\n        }\r\n\r\n        mergeSchemas(\r\n            userSchemas: TableSchema[] = [],\r\n            pluginSchemas: TableSchema[] = []\r\n        ): TableSchema[] {\r\n            // User schemas have priority\r\n            const merged = [...userSchemas];\r\n            const userTables = new Set(userSchemas.map(s => s.name));\r\n\r\n            for (const schema of pluginSchemas) {\r\n                if (!userTables.has(schema.name)) {\r\n                    merged.push(schema);\r\n                } else {\r\n                    this.logger.info(`Skipping plugin schema ${schema.name} (overridden by user)`);\r\n                }\r\n            }\r\n\r\n            return merged;\r\n        }\r\n\r\n        mergeStatic(\r\n            userStatic: StaticConfig[] = [],\r\n            pluginStatic: StaticConfig[] = []\r\n        ): StaticConfig[] {\r\n            return [...userStatic, ...pluginStatic];\r\n        }\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝","// src/mod/plugin_registry.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import * as types from '../types';\r\n    import { Logger } from './logger';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class PluginRegistry {\r\n        private plugins: types.CruxPlugin[] = [];\r\n        private logger: Logger;\r\n\r\n        constructor(logger: Logger) {\r\n            this.logger = logger;\r\n        }\r\n\r\n        async register(plugin: types.CruxPlugin, app: types.AppInstance) {\r\n            this.logger.info(`Registering plugin: ${plugin.name}`);\r\n\r\n            this.plugins.push(plugin);\r\n\r\n            // Call plugin's onRegister hook\r\n            if (plugin.onRegister) {\r\n                await plugin.onRegister(app);\r\n            }\r\n\r\n            this.logger.success(`Plugin registered: ${plugin.name} v${plugin.version}`);\r\n        }\r\n\r\n        getAll(): types.CruxPlugin[] {\r\n            return this.plugins;\r\n        }\r\n\r\n        async callHook(\r\n            hook: keyof Pick<types.CruxPlugin, 'onAwake' | 'onStart' | 'onReady' | 'onShutdown'>,\r\n            ctx: types.LifecycleContext\r\n        ) {\r\n            for (const plugin of this.plugins) {\r\n                if (plugin[hook]) {\r\n                    this.logger.plugin(plugin.name, `Calling ${hook}`);\r\n                    await plugin[hook]!(ctx);\r\n                }\r\n            }\r\n        }\r\n\r\n        collectRoutes(): types.RouteDefinition[] {\r\n            const routes: types.RouteDefinition[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.routes) {\r\n                    routes.push(...plugin.routes);\r\n                    this.logger.plugin(plugin.name, `Provided ${plugin.routes.length} routes`);\r\n                }\r\n            }\r\n\r\n            return routes;\r\n        }\r\n\r\n        collectSchemas(): types.TableSchema[] {\r\n            const schemas: types.TableSchema[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.schemas) {\r\n                    schemas.push(...plugin.schemas);\r\n                    this.logger.plugin(plugin.name, `Provided ${plugin.schemas.length} schemas`);\r\n                }\r\n            }\r\n\r\n            return schemas;\r\n        }\r\n\r\n        collectMiddlewares(): Map<string, types.AppMiddleware> {\r\n            const middlewares = new Map<string, types.AppMiddleware>();\r\n\r\n            for (const plugin of this.plugins) {\r\n            if (plugin.middlewares) {\r\n                for (const mw of plugin.middlewares) {\r\n                    middlewares.set(`${plugin.name}:${mw.name}`, mw.handler);\r\n                    this.logger.plugin(plugin.name, `Provided middleware: ${mw.name}`);\r\n                }\r\n            }\r\n            }\r\n\r\n            return middlewares;\r\n        }\r\n\r\n        collectStatic(): types.StaticConfig[] {\r\n            const statics: types.StaticConfig[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.static) {\r\n                    statics.push(...plugin.static);\r\n                    this.logger.plugin(plugin.name, `Provided ${plugin.static.length} static configs`);\r\n                }\r\n            }\r\n\r\n            return statics;\r\n        }\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝"]}