{"version":3,"sources":["../src/mod/logger.ts","../src/mod/resource_merger.ts","../src/mod/plugin_registry.ts"],"names":["logger","Logger","ResourceMerger","userRoutes","pluginRoutes","merged","userPaths","r","route","key","userSchemas","pluginSchemas","userTables","schema","userStatic","pluginStatic","PluginRegistry","plugin","app","hook","ctx","routes","schemas","middlewares","mw","statics"],"mappings":"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","file":"index.js","sourcesContent":["// src/mod/logger.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import { Logger } from '@minejs/logger';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export const logger = new Logger('debug', true, '[CruxJS]');\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝","// src/mod/resource_merger.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import { RouteDefinition, TableSchema, StaticConfig } from '../types';\r\n    import { logger } from './logger';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class ResourceMerger {\r\n\r\n        constructor() {\r\n        }\r\n\r\n        mergeRoutes(\r\n            userRoutes: RouteDefinition[] = [],\r\n            pluginRoutes: RouteDefinition[] = []\r\n        ): RouteDefinition[] {\r\n            // User routes have priority\r\n            const merged = [...userRoutes];\r\n            const userPaths = new Set(userRoutes.map(r => `${r.method}:${r.path}`));\r\n\r\n            for (const route of pluginRoutes) {\r\n                const key = `${route.method}:${route.path}`;\r\n\r\n                if (!userPaths.has(key)) {\r\n                    merged.push(route);\r\n                } else {\r\n                    logger.debug(`Skipping plugin route ${key} (overridden by user)`);\r\n                }\r\n            }\r\n\r\n            return merged;\r\n        }\r\n\r\n        mergeSchemas(\r\n            userSchemas: TableSchema[] = [],\r\n            pluginSchemas: TableSchema[] = []\r\n        ): TableSchema[] {\r\n            // User schemas have priority\r\n            const merged = [...userSchemas];\r\n            const userTables = new Set(userSchemas.map(s => s.name));\r\n\r\n            for (const schema of pluginSchemas) {\r\n                if (!userTables.has(schema.name)) {\r\n                    merged.push(schema);\r\n                } else {\r\n                    logger.debug(`Skipping plugin schema ${schema.name} (overridden by user)`);\r\n                }\r\n            }\r\n\r\n            return merged;\r\n        }\r\n\r\n        mergeStatic(\r\n            userStatic: StaticConfig[] = [],\r\n            pluginStatic: StaticConfig[] = []\r\n        ): StaticConfig[] {\r\n            return [...userStatic, ...pluginStatic];\r\n        }\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝","// src/mod/plugin_registry.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import * as types from '../types';\r\n    import { logger } from './logger';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class PluginRegistry {\r\n        private plugins: types.CruxPlugin[] = [];\r\n\r\n        constructor() {\r\n        }\r\n\r\n        async register(plugin: types.CruxPlugin, app: types.AppInstance) {\r\n            logger.debug(`Registering plugin: ${plugin.name}`);\r\n\r\n            this.plugins.push(plugin);\r\n\r\n            // Call plugin's onRegister hook\r\n            if (plugin.onRegister) {\r\n                await plugin.onRegister(app);\r\n            }\r\n\r\n            logger.debug(`Plugin registered: ${plugin.name} v${plugin.version}`);\r\n        }\r\n\r\n        getAll(): types.CruxPlugin[] {\r\n            return this.plugins;\r\n        }\r\n\r\n        async callHook(\r\n            hook: keyof Pick<types.CruxPlugin, 'onAwake' | 'onStart' | 'onReady' | 'onShutdown'>,\r\n            ctx: types.LifecycleContext\r\n        ) {\r\n            for (const plugin of this.plugins) {\r\n                if (plugin[hook]) {\r\n                    logger.debug(plugin.name, `Calling ${hook}`);\r\n                    await plugin[hook]!(ctx);\r\n                }\r\n            }\r\n        }\r\n\r\n        collectRoutes(): types.RouteDefinition[] {\r\n            const routes: types.RouteDefinition[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.routes) {\r\n                    routes.push(...plugin.routes);\r\n                    logger.debug(plugin.name, `Provided ${plugin.routes.length} routes`);\r\n                }\r\n            }\r\n\r\n            return routes;\r\n        }\r\n\r\n        collectSchemas(): types.TableSchema[] {\r\n            const schemas: types.TableSchema[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.schemas) {\r\n                    schemas.push(...plugin.schemas);\r\n                    logger.debug(plugin.name, `Provided ${plugin.schemas.length} schemas`);\r\n                }\r\n            }\r\n\r\n            return schemas;\r\n        }\r\n\r\n        collectMiddlewares(): Map<string, types.AppMiddleware> {\r\n            const middlewares = new Map<string, types.AppMiddleware>();\r\n\r\n            for (const plugin of this.plugins) {\r\n            if (plugin.middlewares) {\r\n                for (const mw of plugin.middlewares) {\r\n                    middlewares.set(`${plugin.name}:${mw.name}`, mw.handler);\r\n                    logger.debug(plugin.name, `Provided middleware: ${mw.name}`);\r\n                }\r\n            }\r\n            }\r\n\r\n            return middlewares;\r\n        }\r\n\r\n        collectStatic(): types.StaticConfig[] {\r\n            const statics: types.StaticConfig[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.static) {\r\n                    statics.push(...plugin.static);\r\n                    logger.debug(plugin.name, `Provided ${plugin.static.length} static configs`);\r\n                }\r\n            }\r\n\r\n            return statics;\r\n        }\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝"]}