{"version":3,"sources":["../src/mod/logger.ts","../src/mod/resource_merger.ts","../src/mod/plugin_registry.ts"],"names":["logger","Logger","ResourceMerger","userRoutes","pluginRoutes","merged","userPaths","r","route","key","userSchemas","pluginSchemas","userTables","s","schema","userStatic","pluginStatic","PluginRegistry","plugin","app","hook","ctx","routes","schemas","middlewares","mw","statics"],"mappings":"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","file":"index.js","sourcesContent":["// src/mod/logger.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import { Logger } from '@minejs/logger';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export const logger = new Logger('debug', true, '[CruxJS]');\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝","// src/mod/resource_merger.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import { RouteDefinition, TableSchema, StaticConfig } from '../types';\r\n    import { Logger } from '@minejs/logger';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class ResourceMerger {\r\n        private logger: Logger;\r\n\r\n        constructor(logger: Logger) {\r\n            this.logger = logger;\r\n        }\r\n\r\n        mergeRoutes(\r\n            userRoutes: RouteDefinition[] = [],\r\n            pluginRoutes: RouteDefinition[] = []\r\n        ): RouteDefinition[] {\r\n            // User routes have priority\r\n            const merged = [...userRoutes];\r\n            const userPaths = new Set(userRoutes.map(r => `${r.method}:${r.path}`));\r\n\r\n            for (const route of pluginRoutes) {\r\n                const key = `${route.method}:${route.path}`;\r\n\r\n                if (!userPaths.has(key)) {\r\n                    merged.push(route);\r\n                } else {\r\n                    this.logger.info(`Skipping plugin route ${key} (overridden by user)`);\r\n                }\r\n            }\r\n\r\n            return merged;\r\n        }\r\n\r\n        mergeSchemas(\r\n            userSchemas: TableSchema[] = [],\r\n            pluginSchemas: TableSchema[] = []\r\n        ): TableSchema[] {\r\n            // User schemas have priority\r\n            const merged = [...userSchemas];\r\n            const userTables = new Set(userSchemas.map(s => s.name));\r\n\r\n            for (const schema of pluginSchemas) {\r\n                if (!userTables.has(schema.name)) {\r\n                    merged.push(schema);\r\n                } else {\r\n                    this.logger.info(`Skipping plugin schema ${schema.name} (overridden by user)`);\r\n                }\r\n            }\r\n\r\n            return merged;\r\n        }\r\n\r\n        mergeStatic(\r\n            userStatic: StaticConfig[] = [],\r\n            pluginStatic: StaticConfig[] = []\r\n        ): StaticConfig[] {\r\n            return [...userStatic, ...pluginStatic];\r\n        }\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝","// src/mod/plugin_registry.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import * as types from '../types';\r\n    import { Logger } from '@minejs/logger';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class PluginRegistry {\r\n        private plugins: types.CruxPlugin[] = [];\r\n        private logger: Logger;\r\n\r\n        constructor(logger: Logger) {\r\n            this.logger = logger;\r\n        }\r\n\r\n        async register(plugin: types.CruxPlugin, app: types.AppInstance) {\r\n            this.logger.info(`Registering plugin: ${plugin.name}`);\r\n\r\n            this.plugins.push(plugin);\r\n\r\n            // Call plugin's onRegister hook\r\n            if (plugin.onRegister) {\r\n                await plugin.onRegister(app);\r\n            }\r\n\r\n            this.logger.debug(`Plugin registered: ${plugin.name} v${plugin.version}`);\r\n        }\r\n\r\n        getAll(): types.CruxPlugin[] {\r\n            return this.plugins;\r\n        }\r\n\r\n        async callHook(\r\n            hook: keyof Pick<types.CruxPlugin, 'onAwake' | 'onStart' | 'onReady' | 'onShutdown'>,\r\n            ctx: types.LifecycleContext\r\n        ) {\r\n            for (const plugin of this.plugins) {\r\n                if (plugin[hook]) {\r\n                    this.logger.debug(plugin.name, `Calling ${hook}`);\r\n                    await plugin[hook]!(ctx);\r\n                }\r\n            }\r\n        }\r\n\r\n        collectRoutes(): types.RouteDefinition[] {\r\n            const routes: types.RouteDefinition[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.routes) {\r\n                    routes.push(...plugin.routes);\r\n                    this.logger.debug(plugin.name, `Provided ${plugin.routes.length} routes`);\r\n                }\r\n            }\r\n\r\n            return routes;\r\n        }\r\n\r\n        collectSchemas(): types.TableSchema[] {\r\n            const schemas: types.TableSchema[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.schemas) {\r\n                    schemas.push(...plugin.schemas);\r\n                    this.logger.debug(plugin.name, `Provided ${plugin.schemas.length} schemas`);\r\n                }\r\n            }\r\n\r\n            return schemas;\r\n        }\r\n\r\n        collectMiddlewares(): Map<string, types.AppMiddleware> {\r\n            const middlewares = new Map<string, types.AppMiddleware>();\r\n\r\n            for (const plugin of this.plugins) {\r\n            if (plugin.middlewares) {\r\n                for (const mw of plugin.middlewares) {\r\n                    middlewares.set(`${plugin.name}:${mw.name}`, mw.handler);\r\n                    this.logger.debug(plugin.name, `Provided middleware: ${mw.name}`);\r\n                }\r\n            }\r\n            }\r\n\r\n            return middlewares;\r\n        }\r\n\r\n        collectStatic(): types.StaticConfig[] {\r\n            const statics: types.StaticConfig[] = [];\r\n\r\n            for (const plugin of this.plugins) {\r\n                if (plugin.static) {\r\n                    statics.push(...plugin.static);\r\n                    this.logger.debug(plugin.name, `Provided ${plugin.static.length} static configs`);\r\n                }\r\n            }\r\n\r\n            return statics;\r\n        }\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝"]}